{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/cypilot/kit-constraints.schema.json",
  "title": "Cypilot Kit Constraints (constraints.json)",
  "type": "object",
  "description": "Kit-level constraints for artifact IDs. Root keys are artifact kinds (e.g. PRD, DESIGN, SPEC).",
  "propertyNames": {
    "type": "string",
    "minLength": 1
  },
  "additionalProperties": {
    "$ref": "#/$defs/artifact_kind_constraints"
  },
  "$defs": {
    "artifact_kind_constraints": {
      "type": "object",
      "additionalProperties": false,
      "required": ["identifiers"],
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "identifiers": {
          "type": "object",
          "description": "Map of id kind to its constraint entry.",
          "propertyNames": { "type": "string", "minLength": 1 },
          "additionalProperties": { "$ref": "#/$defs/id_constraint_entry" }
        }
      }
    },
    "id_constraint_entry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "kind": { "type": "string", "minLength": 1 },
        "required": { "type": "boolean" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "examples": {
          "type": "array",
          "items": {}
        },
        "task": {
          "type": "string",
          "enum": ["required", "allowed", "prohibited"]
        },
        "priority": {
          "type": "string",
          "enum": ["required", "allowed", "prohibited"]
        },
        "to_code": { "type": "boolean" },
        "headings": {
          "type": "array",
          "items": { "type": "string" }
        },
        "references": {
          "type": "object",
          "description": "Map of artifact kinds to reference rules.",
          "propertyNames": { "type": "string", "minLength": 1 },
          "additionalProperties": { "$ref": "#/$defs/reference_rule" }
        }
      }
    },
    "reference_rule": {
      "type": "object",
      "additionalProperties": false,
      "required": ["coverage"],
      "properties": {
        "coverage": {
          "type": "string",
          "enum": ["required", "optional", "prohibited"]
        },
        "task": {
          "type": "string",
          "enum": ["required", "allowed", "prohibited"]
        },
        "priority": {
          "type": "string",
          "enum": ["required", "allowed", "prohibited"]
        },
        "headings": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
